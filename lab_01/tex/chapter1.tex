\chapter{Основные определения}

\textbf{Тик} --- период времени между двумя последующими прерываниями таймера \cite{unix1}.

\textbf{Основной тик} --- период времени, равный $n$ тикам таймера (число $n$ зависит от конкретного варианта системы) \cite{unix1}.

\textbf{Квант времени} --- временной интервал, в течение которого потоку разрешено работать, пока не настанет очередь запускаться другому потоку с тем же уровнем приоритета \cite{win4}.

\chapter{Функции обработчика прерывания от системного таймера в защищенном режиме}

Обработчик прерывания таймера запускается в ответ на возникновение аппаратного прерывания таймера, являющегося вторым по приоритету событием в системе\footnote{Приоритет процесса --- это параметр, который размещен в контексте процесса, и по значению этого параметра осуществляется выбор очередного процесса для продолжения работы или выбор процесса для его приостановки \cite{plan}.} (после прерывания по сбою питания). Это говорит о том, что никакая другая работа не может выполняться в системе во время его срабатывания. Поэтому обработчик должен запускаться как можно быстрее, а его время работы желательно сводить к минимуму \cite{unix1}. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%            UNIX              %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Unix}

По \textbf{тику}:

\begin{itemize}
    \item[---] инкремент счетчика тиков аппаратного таймера;
    \item[---] инкремент часов и других таймеров системы\footnote{Список некоторых таймеров в системе можно посмотреть с помощью команды {\ttfamily systemctl status *timer}~\cite{timer}.};
    \item[---] декремент кванта текущего потока;
    \item[---] декремент счетчика времени до отправления на выполнение отложенных вызовов\footnote{Отложенный вызов --- запись функции, которую ядро системы должно будет вызвать через определенный промежуток времени \cite{unix2}.}, при достижении счетчиком нуля происходит выставление флага для обработчика отложенного вызова;
    \item[---] обновление статистики использования процессора текущим процессом (инкремент поля {\ttfamily p\_cpu} дескриптора текущего процесса до максимального значения, равного 127).
\end{itemize}

\newpage

По \textbf{главному тику}:

\begin{itemize}
    \item[---] регистрация отложенных вызовов функций, относящихся к работе планировщика\footnote{Планировщик --- компонент ОС, определяющий, какой из процессов должен выполняться в данный момент времени и как долго он может занимать процессор \cite{unix3}.}, таких как пересчет приоритетов;
    
    \item[---] пробуждение системных вызовов {\ttfamily swapper}\footnote{Исторически, системный вызов  {\ttfamily swapper} отвечал за \guillemotleftпроцесс свопинга\guillemotright, то есть за перемещение всех страниц определенного процесса из/в память/резервное хранилище \cite{swapper}.} и {\ttfamily pagedaemon}\footnote{Системный вызов {\ttfamily pagedaemon} --- процесс-демон, управляющий страничной организацией памяти \cite{pagedaemon}.} (то есть регистрация отложенного вызова процедуры {\ttfamily wakeup}, которая перемещает дескриптор процесса из списка \guillemotleftспящих\guillemotright~в очередь \guillemotleftготовых к выполнению\guillemotright);
    
     \item[---] декремент счетчика времени, оставшегося до посылки одного из следующих сигналов \cite{unix4}:
     \begin{itemize}
         \item[---] {\ttfamily SIGALRM} --- сигнал, посылаемый процессору по истечении времени, заданного функцией {\ttfamily alarm()} (будильник реального времени);
         
         \item[---] {\ttfamily SIGPROF} --- сигнал, посылаемый процессору по истечении времени, заданного в таймере профилирования (будильник профиля процесса);

         \item[---] {\ttfamily SIGVTALRM} --- сигнал, посылаемый процессору по истечении времени работы в режиме задачи (будильник виртуального времени);
     \end{itemize}
\end{itemize}

По \textbf{кванту}:

\begin{itemize}
    \item[---] если текущий процесс превысил выделенный ему квант процессорного времени, отправка ему сигнала {\ttfamily SIGXCPU} \cite{unix1}.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%            WINDOWS           %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage

\section{Windows}

По \textbf{тику}:

\begin{itemize}
    \item[---] инкремент счетчика системного времени;
    \item[---] декремент остатка кванта текущего потока;
    \item[---] декремент счетчиков отложенных задач;
    \item[---] если активен механизм профилирования ядра\footnote{Профилирование ядра --- это выявление «узких мест» в производительности. С помощью профилирования можно определить, где именно произошла потеря производительности в той или иной программе. Специальные программы генерируют профиль --- сводку событий, на основе которой можно выяснить, на выполнение каких функций ушло больше всего времени. Эти программы, однако, не помогают выявить причину снижения производительности \cite{prof}.}, то инициализация отложенного вызова обработчика ловушки\footnote{Термин ловушка (trap) относится к механизму, благодаря которому при прерывании или исключении процессор перехватывает контроль над выполняемым потоком и передает управление определенной части операционной системы. B Windows процессор передает управление обработчику ловушек (trap handler) — функции, специфичной для конкретного прерывания или исключения \cite{win2}.} профилирования ядра добавлением объекта в очередь DPC (Deferred procedure call, отложенный вызов процедуры) \cite{win1}. Обработчик ловушки профилирования регистрирует адрес команды, выполнявшейся на момент прерывания.
\end{itemize}

По \textbf{главному тику}:

\begin{itemize}
    \item[---] инициализация диспетчера настройки баланса\footnote{Диспетчер настройки баланса --- системный поток, который активизируется для возможной инициализации событий, связанных с планированием и управлением памятью \cite{win3}.} путем освобождения объекта \guillemotleftсобытие\guillemotright, на котором он ожидает. 
\end{itemize}

По \textbf{кванту}:

\begin{itemize}
    \item[---] инициализация диспетчеризации\footnote{Диспетчеризация заключается в реализации найденного в результате планирования (динамического или статистического) решения, то есть в переключении процессора с одного потока на другой. Прежде чем прервать выполнение потока, ОС запоминает его контекст, с тем, чтобы впоследствии использовать эту информацию для последующего возобновления выполнения данного потока \cite{disp}.} потоков добавлением соответствующего объекта в очередь DPC.
\end{itemize}